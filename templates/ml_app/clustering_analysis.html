{% extends 'ml_app/base.html' %}

{% block title %}Clustering Analysis - Praxis{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="display-5 fw-bold">
        <i class="fas fa-project-diagram"></i> AI Jobs Clustering Analysis
    </h1>
    <p class="lead">Visualization of job clusters based on the global AI market</p>
</div>

{% if error %}
<div class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> An error occurred during the analysis.
    <br>Details: {{ error }}
</div>
{% else %}

<!-- Informations sur les données -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="stats-card">
            <i class="fas fa-database fa-2x mb-2"></i>
            <h3>{{ data_info.total_jobs }}</h3>
            <p>Jobs analyzed</p>
        </div>
    </div>
    <div class="col-md-6">
        <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <i class="fas fa-columns fa-2x mb-2"></i>
            <h3>{{ data_info.features }}</h3>
            <p>Features</p>
        </div>
    </div>
</div>

<!-- Méthode du coude -->
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-chart-line"></i> Elbow Method - Determining the optimal number of clusters
        </h4>
    </div>
    <div class="card-body">
        <p>The elbow method helps determine the optimal number of clusters by analyzing inertia.</p>
        <div class="plot-container">
            <img src="data:image/png;base64,{{ elbow_plot }}" alt="Elbow Method" class="img-fluid">
        </div>
    </div>
</div>

<!-- Taille des clusters -->
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-chart-pie"></i> Cluster Size and Distribution
        </h4>
    </div>
    <div class="card-body">
        <p>Distribution of jobs in each identified cluster.</p>
        <div class="plot-container text-center">
            <img src="data:image/png;base64,{{ cluster_sizes_plot }}" alt="Cluster Sizes" class="img-fluid" style="max-height: 600px;">
        </div>
    </div>
</div>

<!-- Visualisation des clusters -->
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-eye"></i> Cluster Visualization (K-means with PCA)
        </h4>
    </div>
    <div class="card-body">
        <p>Projection of jobs onto the first two principal components with their assigned clusters.</p>
        <div class="plot-container text-center">
            <img src="data:image/png;base64,{{ cluster_plot }}" alt="Cluster Visualization" class="img-fluid" style="max-height: 600px;">
        </div>
    </div>
</div>

<!-- Comparaison des profils de clusters -->
{% if cluster_comparison_plot %}
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-balance-scale"></i> Cluster Profile Comparison
        </h4>
    </div>
    <div class="card-body">
        <p>Comparison of average values of numerical features between clusters.</p>
        <div class="plot-container text-center">
            <img src="data:image/png;base64,{{ cluster_comparison_plot }}" alt="Cluster Comparison" class="img-fluid" style="max-height: 700px;">
        </div>
    </div>
</div>
{% endif %}

<!-- Distribution des features par cluster -->
{% if cluster_distributions_plot %}
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-chart-area"></i> Feature Distribution by Cluster
        </h4>
    </div>
    <div class="card-body">
        <p>Histograms showing the distribution of numerical features in each cluster.</p>
        <div class="plot-container text-center">
            <img src="data:image/png;base64,{{ cluster_distributions_plot }}" alt="Distribution by Cluster" class="img-fluid">
        </div>
    </div>
</div>
{% endif %}

<!-- Profils des clusters -->
<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">
            <i class="fas fa-users"></i> Cluster Profiles
        </h4>
    </div>
    <div class="card-body">
        <p>Detailed characteristics of each identified cluster.</p>
        
        <div class="row">
            {% for cluster_name, profile in profiles.items %}
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">{{ cluster_name }}</h5>
                    </div>
                    <div class="card-body">
                        <p><strong><i class="fas fa-users"></i> Taille:</strong> {{ profile.size }} jobs ({{ profile.percentage }}%)</p>
                        
                        {% if profile.salary_usd %}
                        <hr>
                        <h6><i class="fas fa-dollar-sign"></i> Salary (USD)</h6>
                        <ul class="list-unstyled">
                            <li>Average: ${{ profile.salary_usd.mean|floatformat:0 }}</li>
                            <li>Median: ${{ profile.salary_usd.median|floatformat:0 }}</li>
                            <li>Min: ${{ profile.salary_usd.min|floatformat:0 }}</li>
                            <li>Max: ${{ profile.salary_usd.max|floatformat:0 }}</li>
                        </ul>
                        {% endif %}
                        
                        {% if profile.years_experience %}
                        <hr>
                        <h6><i class="fas fa-briefcase"></i> Years of experience</h6>
                        <ul class="list-unstyled">
                            <li>Average: {{ profile.years_experience.mean|floatformat:1 }} years</li>
                            <li>Median: {{ profile.years_experience.median|floatformat:1 }} years</li>
                        </ul>
                        {% endif %}
                        
                        <hr>
                        <h6><i class="fas fa-tags"></i> Dominant characteristics</h6>
                        <ul class="list-unstyled">
                            {% if profile.experience_level_dominant %}
                            <li><strong>Level:</strong> {{ profile.experience_level_dominant }}</li>
                            {% endif %}
                            {% if profile.company_location_dominant %}
                            <li><strong>Location:</strong> {{ profile.company_location_dominant }}</li>
                            {% endif %}
                            {% if profile.company_size_dominant %}
                            <li><strong>Company size:</strong> {{ profile.company_size_dominant }}</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Actions -->
<div class="text-center mb-4">
    <a href="{% url 'ml_app:clustering_predict' %}" class="btn btn-primary btn-lg">
        <i class="fas fa-search"></i> Predict Job Cluster
    </a>
    <a href="{% url 'ml_app:home' %}" class="btn btn-outline-secondary btn-lg">
        <i class="fas fa-home"></i> Back to home
    </a>
</div>

{% endif %}
{% endblock %}
